trigger:
  tags:
    include:
    - '*'
  branches:
    exclude:
    - master

jobs:
  - job: 'Deploy'
    condition: startsWith(variables['Build.SourceBranch'], 'refs/tags/')
    pool:
      vmImage: 'macOS-latest'
    timeoutInMinutes: 6
    variables:
    - name : tagName
      value: $[ replace(variables['Build.SourceBranch'], 'refs/tags/', '') ] 
    steps:
      - script: |
          export NUGET_API_KEY=$(NUGET_API_KEY)
          dotnet workload install maui-android
          dotnet workload install maui-ios
          dotnet tool restore
          dotnet cake --configuration release --release-version $(tagName)
          dotnet cake --target Nuget --release-version $(tagName)
        displayName: 'Deploy'
